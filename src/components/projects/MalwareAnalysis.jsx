import { Link } from "react-router-dom";

import vbox1 from "/screenshots/malanalysis/vbox1.png";
import win11config from "/screenshots/malanalysis/win11-config.png";
import remnuxconfig from "/screenshots/malanalysis/remnux-config.png";
import pestudio from "/screenshots/malanalysis/pestudio.png";
import capa from "/screenshots/malanalysis/capa.png";
import ghidra from "/screenshots/malanalysis/ghidra.png";
import procmon from "/screenshots/malanalysis/procmon.png";
import apimon from "/screenshots/malanalysis/apimon.png";
import procexp from "/screenshots/malanalysis/procexp.png";
import wireshark from "/screenshots/malanalysis/wireshark.png";

function SectionHeader({ title }) {
  return (
    <div className="flex items-center gap-2 my-4">
      <h2 className="font-semibold text-blue-800 whitespace-nowrap text-xl md:text-2xl">
        {title}
      </h2>
      <div className="flex-1 h-px bg-blue-800" />
    </div>
  );
}

function SubSectionHeader({ title }) {
  return (
    <div className="flex items-center gap-2 my-6 ml-4">
      <h3 className="font-semibold text-blue-700 whitespace-nowrap text-lg">
        {title}
      </h3>
      <div className="flex-1 h-px bg-blue-300" />
    </div>
  );
}

export default function MalwareAnalysis() {
  return (
    <section className="min-h-screen px-6 py-24 max-w-5xl mx-auto text-gray-900">

      {/* Breadcrumb */}
      <div className="text-sm mb-10 font-mono tracking-wide">
        <Link
          to="/#projects"
          className="text-blue-600 hover:text-blue-800 transition"
        >
          ← Back to Projects
        </Link>
      </div>

      {/* Title */}
      <h1 className="text-4xl md:text-5xl font-semibold tracking-tight text-blue-900">
        Malware Analysis Lab
      </h1>

      <p className="font-mono text-sm text-blue-700 mt-2 mb-12">
        Windows · REMnux · FLARE VM · MITRE ATT&CK · YARA-X
      </p>

      <div className="space-y-14 leading-relaxed">

        {/* Overview */}
        <section>
          <h2 className="text-2xl md:text-3xl font-semibold mb-6 text-blue-900">
            Overview
          </h2>

          <p className="text-gray-700 text-lg">
            This project focused on designing and operating a dedicated malware
            analysis laboratory for safely examining malicious Windows PE samples.
            The environment supports repeatable static and dynamic analysis while
            maintaining strict network isolation. Observed behaviors are translated
            into standardized detection artifacts suitable for SOC and IR workflows.
          </p>
        </section>

        {/* VirtualBox Configuration */}
        <section>
          <h2 className="text-2xl md:text-3xl font-semibold mb-6 text-blue-900">
            VirtualBox Configuration
          </h2>

          <div className="flex flex-col md:flex-row gap-10 items-start">
            <div className="flex-1 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
              <p className="text-gray-700 text-lg mb-4">
                The analysis environment was isolated using a host-only VirtualBox
                network to safely observe malware behavior without external exposure.
              </p>

              <ul className="list-disc pl-6 space-y-2 text-gray-700 text-lg">
                <li>Host-only VirtualBox networking</li>
                <li>No outbound internet access</li>
                <li>Static IP addressing</li>
              </ul>
            </div>

            <div className="md:w-1/2 h-[260px] rounded-2xl overflow-hidden shadow-sm bg-gray-50">
              <img
                src={vbox1}
                alt="VirtualBox malware analysis network configuration"
                className="w-full h-full object-cover"
              />
            </div>
          </div>
        </section>

        <section>
          <div className="space-y-12">
            {/* Windows VM */}
            <section>
              <h2 className="text-2xl md:text-3xl font-semibold mb-6 text-blue-900">
                Windows Victim VM
              </h2>

              <div className="flex flex-col md:flex-row-reverse gap-10 items-start">
                <div className="flex-1 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
                  <p className="text-gray-700 text-lg mb-4">
                    The Windows 11 virtual machine served as the primary malware
                    execution configured to maximize visibility during dynamic analysis.
                  </p>

                  <ul className="list-disc pl-6 space-y-2 text-gray-700 text-lg">
                    <li>Windows Defender and ASR disabled</li>
                    <li>FLARE VM tooling installed</li>
                    <li>Snapshot-based rollback for repeatable testing</li>
                  </ul>
                </div>

                <div className="md:w-1/2 h-[260px] rounded-2xl overflow-hidden shadow-sm bg-gray-50">
                  <img
                    src={win11config}
                    alt="Windows malware analysis VM"
                    className="w-full h-full object-cover"
                  />
                </div>
              </div>
            </section>

            {/* REMnux VM */}
            <section>
              <h2 className="text-2xl md:text-3xl font-semibold mb-6 text-blue-900">
                REMnux Analysis VM
              </h2>

              <div className="flex flex-col md:flex-row gap-10 items-start">
                <div className="flex-1 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
                  <p className="text-gray-700 text-lg mb-4">
                    The REMnux virtual machine provided simulated network services
                    and traffic inspection capabilities for observing
                    C2 behavior without internet access.
                  </p>

                  <ul className="list-disc pl-6 space-y-2 text-gray-700 text-lg">
                    <li>FakeDNS and INetSim for C2 emulation</li>
                    <li>Wireshark and tcpdump for packet capture</li>
                    <li>HTTP, DNS, and TLS traffic inspection</li>
                  </ul>
                </div>

                <div className="md:w-1/2 h-[260px] rounded-2xl overflow-hidden shadow-sm bg-gray-50">
                  <img
                    src={remnuxconfig}
                    alt="REMnux malware analysis services"
                    className="w-full h-full object-cover"
                  />
                </div>
              </div>
            </section>

          </div>
        </section>

        {/* Static Analysis */}
        <section>
          <SectionHeader title="Static Analysis Techniques" />

          <p className="text-gray-700 text-lg mb-6">
            Static analysis techniques were deployed to analyze various Windows PE samples without
            executing them. This phase in the malware analysis lifecycle focused heavily on determining
            the malware's structure, functionality, and potential capabilities by examining strings,
            imported APIs, section headers, decompiled code, and control-flow constructs. These
            findings provided early insight into likely execution paths, persistence mechanisms, and
            network behavior, allowing hypotheses to be formed prior to dynamic execution.
          </p>

          <SubSectionHeader title="PEStudio" />

          <div className="flex flex-col md:flex-row gap-6 ml-4 mb-8 items-start">
            <div className="md:w-1/3 h-[220px] rounded-xl overflow-hidden bg-gray-50 shadow-sm">
              <img
                src={pestudio}
                alt="PEStudio static analysis"
                className="w-full h-full object-cover"
              />
          </div>

            <p className="text-gray-700 text-lg md:w-2/3">
              PEStudio was often utilized for the unique identification and initial triage of malware samples, 
              providing visibility into unique hashes and suspicious indicators such as file/import hashes, 
              embedded strings, suspicious IAT entires, and more.
              <br></br><br></br>
              File attributes commonly observed in malicious PE samples included UPX packed 
              sections, suspicious IAT entries and strings, and invalid or missing
              digital signatures.
            </p>
          </div>

          <SubSectionHeader title="capa" />

          <div className="flex flex-col md:flex-row gap-6 ml-4 mb-8 items-start">
            <div className="md:w-1/2 h-[260px] rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
              <img
                src={capa}
                alt="capa capability analysis output"
                className="w-full h-full object-cover"
              />
            </div>

            <p className="text-gray-700 text-lg md:w-1/2">
              Capa was used as a rapid capability triage tool used alongside traditional static and
              dynamic analysis techniques. By applying rule-based pattern matching, capa
              identifies mapped MITRE ATT&CK tactics and techniques, Malware Behavior Catalog
              (MBC) objectives, and high-level behavioral capabilities present within the sample.
              Capa defined possible capabilities and functionalities to look for in further static
              and dynamic analysis results.
            </p>
          </div>

          <SubSectionHeader title="Ghidra" />

          <div className="ml-4 mb-1">
            <div className="rounded-xl border border-gray-200 overflow-hidden shadow-sm">
              <img
                src={ghidra}
                alt="Ghidra decompiled code view"
                className="
                  w-full
                  object-cover
                  -m-1
                "
              />
            </div>
          </div>

          <p className="text-gray-700 text-lg ml-4 mt-6">
            Ghidra was used for deeper static analysis of malware samples, enabling inspection
            of decompiled logic, control flow, and API usage patterns. Through reverse engineering,
            dynamically resolved imports, registry manipulation, and defense evasion techniques
            could be identified even when not present in the static import table.
          </p>

        </section>

        {/* Dynamic Analysis */}
        <section>
          <SectionHeader title="Dynamic Analysis Techniques" />

          <p className="text-gray-700 text-lg mb-6">
            Dynamic analysis was conducted by executing malware samples in a controlled
            environment to observe real-time behavior, system interaction, and network
            activity. The following tools were used to capture runtime indicators and
            behavioral artifacts.
          </p>

          {/* Procmon */}
          <SubSectionHeader title="Process Monitor (Procmon)" />

          <div className="ml-4 mb-10">
            <div className="rounded-xl border border-gray-200 overflow-hidden shadow-sm mb-6">
              <img
                src={procmon}
                alt="Procmon filesystem and registry activity"
                className="w-full object-cover -m-1"
              />
            </div>

            <p className="text-gray-700 text-lg">
              Procmon was used to observe real-time filesystem, registry, and process
              activity generated during malware execution. This enabled identification
              of persistence mechanisms, dropped files, registry modifications, and
              encryption-related file operations.
            </p>
          </div>

          {/* API Monitor */}
          <SubSectionHeader title="API Monitor (APIMon)" />

          <div className="ml-4 mb-10">
            <div className="rounded-xl border border-gray-200 overflow-hidden shadow-sm mb-6">
              <img
                src={apimon}
                alt="API Monitor Windows API call tracing"
                className="w-full object-cover -m-1"
              />
            </div>

            <p className="text-gray-700 text-lg">
              API Monitor was leveraged to trace Windows API calls at runtime, providing
              visibility into cryptographic routines, privilege checks, process creation,
              injection attempts, and network-related API usage. This allowed correlation
              between high-level behaviors and low-level Windows API invocations that are
              often obscured during static analysis.
            </p>
          </div>

          {/* Process Explorer */}
          <SubSectionHeader title="Process Explorer" />

          <div className="flex flex-col md:flex-row gap-6 ml-4 mb-10 items-start">
            {/* Image */}
            <div className="md:w-1/3 rounded-xl border border-gray-200 overflow-hidden shadow-sm">
              <img
                src={procexp}
                alt="Process Explorer process tree and loaded modules"
                className="w-full h-full object-cover -m-1"
              />
            </div>

            {/* Text */}
            <p className="text-gray-700 text-lg md:w-2/3">
              Process Explorer was used to inspect running processes, parent–child
              relationships, loaded DLLs, and thread activity during execution.
              This enabled identification of masquerading behavior, suspicious
              injected modules, and abnormal execution contexts that are not always
              visible through traditional task managers.
            </p>
          </div>

          {/* Wireshark */}
          <SubSectionHeader title="Wireshark" />

          <div className="ml-4">
            <div className="rounded-xl border border-gray-200 overflow-hidden shadow-sm mb-6">
              <img
                src={wireshark}
                alt="Wireshark network traffic capture"
                className="w-full object-cover -m-1"
              />
            </div>

            <p className="text-gray-700 text-lg">
              Wireshark was used to capture and analyze network traffic generated by the
              malware during execution. Observed DNS queries, HTTP requests, and protocol
              usage were analyzed to identify potential command-and-control communication
              patterns and exfiltration behavior.
            </p>
          </div>
        </section>

        {/* IoC Extraction */}
        <section>
          <SectionHeader title="Indicator of Compromise (IoC) Extraction" />

          <ul className="list-disc pl-6 space-y-3 text-gray-700 text-lg">
            <li>Malicious file hashes and filenames</li>
            <li>Registry keys and persistence artifacts</li>
            <li>Suspicious process and command-line patterns</li>
            <li>Observed network indicators (domains, URIs, IPs)</li>
          </ul>
        </section>

        {/* MITRE Mapping */}
        <section>
          <SectionHeader title="MITRE ATT&CK Mapping" />

          <p className="text-gray-700 text-lg">
            All observed behaviors were mapped to the MITRE ATT&CK framework to
            provide standardized threat context. This mapping supports correlation
            with existing detections, adversary emulation, and defensive gap analysis.
          </p>
        </section>

        {/* YARA-X */}
        <section>
          <SectionHeader title="YARA-X Detection Rules" />

          <ul className="list-disc pl-6 space-y-3 text-gray-700 text-lg">
            <li>Rule creation based on static and behavioral artifacts</li>
            <li>Use of strings, metadata, and structural indicators</li>
            <li>False-positive testing against legitimate binaries</li>
            <li>Rules designed for SOC-scale deployment</li>
          </ul>
        </section>

        {/* Conclusion */}
        <section>
          <SectionHeader title="Conclusion" />

          <p className="text-gray-700 text-lg">
            This malware analysis lab demonstrates a structured, repeatable, and
            industry-aligned approach to malware research. By combining professional
            tooling, controlled execution environments, and standardized frameworks,
            the lab produces high-confidence findings suitable for real-world SOC,
            DFIR, and detection engineering use cases.
          </p>
        </section>

      </div>

      <div className="h-20" />
    </section>
  );
}
